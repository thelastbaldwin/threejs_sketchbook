<!DOCTYPE html>
<html>
<head>
	<title>Noise Terrain</title>
	<script src="js/third_party/three.min.js"></script>
	<script src="js/third_party/stats.min.js"></script>
	<script src="js/third_party/dat.gui.min.js"></script>
	<script src="js/third_party/OrbitControls.js"></script>
	<script src="js/third_party/perlin.js"></script>
	<link rel="stylesheet" href="css/style.css">
</head>
<body>
	<div id="Stats-output"></div>
	<div id="WebGL-output"></div>
	<script>
		//use perlin noise to mess with a mesh
		var gui = new dat.GUI();
		var spotlightOptions = new function(){
			this.z = 500;
			this.height = 100;
			this.intensity = 1.0;
			this.distance = 0;
			this.angle = Math.PI/3;
			this.exponent = 10.0;
		};
		gui.add(spotlightOptions, 'z', 100, 500);
		gui.add(spotlightOptions, 'height', -200, 500);
		gui.add(spotlightOptions, 'intensity', 0.0, 1.0);
		gui.add(spotlightOptions, 'distance', 0, 1000);
		gui.add(spotlightOptions, 'angle', Math.PI/3, Math.PI/2);

		var scene = new THREE.Scene(),
			renderer = new THREE.WebGLRenderer(),
			// testAxes = new THREE.AxisHelper(100),
			clock = new THREE.Clock(),
			camera = new THREE.PerspectiveCamera(45, window.innerWidth/ window.innerHeight, 0.1, 1000);
		camera.position.z = -500;
		camera.position.y = 50;
		camera.lookAt(scene.position);

		// var orbitControls = new THREE.OrbitControls(camera);
		
		// scene.add(testAxes);

		// PlaneGeometry(width, height, widthSegments, heightSegments)
		var planeGeometry = new THREE.PlaneBufferGeometry(1000, 1000, 100, 100);
		var positions = planeGeometry.attributes.position.array;
		var offset;
		for(var i = 2; i < positions.length; i+=3){
			offset = noise.perlin3(i-2/10, i-1/10, i/10);
			positions[i] = positions[i]+ offset * 10;
		}
		planeGeometry.computeVertexNormals();

		// var planeMaterial = new THREE.MeshLambertMaterial({color: 0xCCCCCC});

		var planePhongMaterial = new THREE.MeshPhongMaterial({ 
			ambient: 0xfffff, 
			color: 0x0000ff, 
			specular: 0xac4848, 
			shininess: 50, 
			shading: THREE.FlatShading
		});
		var planeWireframeMaterial = new THREE.MeshPhongMaterial({
			color: 0xcccccc,
			specular: 0xffffff,
			shininess: 100,
			wireframeLinewidth: 3,
			wireframe: true,
		});
		var plane = THREE.SceneUtils.createMultiMaterialObject(planeGeometry, [	
			planePhongMaterial,
			planeWireframeMaterial
		]);
		plane.rotation.x = -Math.PI/2;

		scene.add(plane);

		renderer.setClearColor(0xcccccc);
		renderer.setSize(window.innerWidth, window.innerHeight);
		renderer.shadowMapEnabled = true;
		//append the renderer element to #WebGL-output

		var outputElement = document.getElementById('WebGL-output');
		outputElement.appendChild(renderer.domElement);

		// var ambientLight = new THREE.AmbientLight(0xff0000);
		// scene.add(ambientLight);

		var spotlight = new THREE.SpotLight(0xFFF9B3);
		spotlight.position.set(0, 100, -200);
		spotlight.castShadow = true;
		scene.add(spotlight);

		var sunMaterial = new THREE.MeshBasicMaterial({
			color: 0xFFF9B3
			// wireframe: true
		});
		var sunGeometry= new THREE.CircleGeometry(100, 32);
		var sunCircle = new THREE.Mesh(sunGeometry, sunMaterial);
		sunCircle.rotation.y = Math.PI;
		scene.add(sunCircle);

		// var spotLightHelper = new THREE.SpotLightHelper(spotlight, 10);
		// this.scene.add(spotLightHelper);

		function renderScene(){
			// pointLight.position.
			// spotLightHelper.update();

			// orbitControls.update(clock.getDelta());
			// spotLightHelper.update();

			sunCircle.position.y = spotlight.position.y = spotlightOptions.height;
			sunCircle.position.z = spotlight.position.z = spotlightOptions.z;

			spotlight.intensity = spotlightOptions.intensity;
			spotlight.distance = spotlightOptions.distance;
			spotlight.angle = spotlightOptions.angle;
			spotlight.exponent = spotlightOptions.exponent;
			spotlight.shadowCameraNear = spotlightOptions.shadowCameraNear;
			spotlight.shadowCameraFar = spotlightOptions.shadowCameraFar;
			spotlight.shadowCameraFov = spotlightOptions.shadowCameraFov;

			requestAnimationFrame(renderScene);
			renderer.render(scene,camera);
		}

		renderScene();

	</script>
</body>